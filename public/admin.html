<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<title>後台管理</title>
<script src="/socket.io/socket.io.js"></script>
<style>
/* 整體背景與字體 */
body {
  font-family: "Microsoft JhengHei", sans-serif;
  text-align: center;
  background: #f0f4f8;  /* 前台背景色相同 */
  margin: 0;
  padding-top: 50px;
}

/* 標題 */
h1 {
  font-size: 3rem;
  color: #dc2626;
  margin-bottom: 30px;
}

/* 目前號碼顯示 */
#number {
  font-size: 5rem;
  color: #2563eb;  /* 前台號碼顏色 */
  margin: 20px 0;
}

/* 按鈕樣式 */
button {
  font-size: 1.2rem;
  padding: 10px 20px;
  margin: 10px 5px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  color: white;
}
#prev { background-color: #ef4444; }    /* 紅色上一號 */
#next { background-color: #10b981; }    /* 綠色下一號 */
#setNumber { background-color: #2563eb; } /* 藍色設定號碼 */
#setText { background-color: #f59e0b; }   /* 橙色設定文字 */

/* 輸入框與文字框 */
input, textarea {
  font-size: 1.2rem;
  padding: 8px;
  width: 300px;
  text-align: center;
  border-radius: 6px;
  border: 1px solid #ccc;
  margin-top: 10px;
}
textarea {
  resize: vertical;
  height: 80px;
  white-space: pre-wrap;   /* 允許換行 */
  word-break: break-word;  /* 過長文字自動換行 */
}
</style>
</head>
<body>

<h1>目前號碼：<span id="number">0</span></h1>

<!-- 上一號 / 下一號 -->
<div>
  <button id="prev">上一號</button>
  <button id="next">下一號</button>
</div>

<!-- 設定號碼 -->
<div>
  <input type="number" id="manualNumber" placeholder="輸入號碼" />
  <button id="setNumber">設定號碼</button>
</div>

<!-- 設定提示文字 -->
<div>
  <textarea id="customText" placeholder="輸入中文文字，可換行"></textarea>
  <button id="setText">設定文字</button>
</div>

<script>
const socket = io();
const numberEl = document.getElementById("number");

let token = localStorage.getItem("adminToken") || "";

if(!token){
  token = prompt("請輸入管理密碼（預設 1234）") || "";
  localStorage.setItem("adminToken", token);
}

// 即時更新號碼
socket.on("update", num => numberEl.textContent = num);

// 改變號碼
async function changeNumber(direction){
  await fetch("/change-number",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({token,direction})
  });
}

// 設定號碼
async function setNumber(){
  const num = document.getElementById("manualNumber").value;
  await fetch("/set-number",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({token,number:num})
  });
  document.getElementById("manualNumber").value="";
}

// 設定提示文字
async function setText(){
  const text = document.getElementById("customText").value;
  await fetch("/set-text",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({token,text})
  });
  document.getElementById("customText").value="";
}

// 綁定按鈕事件
document.getElementById("next").onclick = () => changeNumber("next");
document.getElementById("prev").onclick = () => changeNumber("prev");
document.getElementById("setNumber").onclick = setNumber;
document.getElementById("setText").onclick = setText;
</script>

</body>
</html>
